# JA財務リスク分析システム

日本の農業協同組合（JA）向けの包括的な財務リスク分析プラットフォーム

## 主要機能

### 📊 財務分析
- **5つの主要指標**: 収益性、流動性、効率性、安全性、キャッシュフロー
- **リスクスコア自動計算**: 1-5段階の評価システム
- **前年比較**: 経年変化の追跡と分析
- **レーダーチャート**: 視覚的なリスク評価表示

### 🏢 JA管理機能
- **年度別データ管理**: 2021年度、2022年度対応
- **マッピング状況表示**: BS、PL、CF各データの処理状況
- **パフォーマンス最適化**: 1.76秒高速読み込み（56%改善）
- **直感的UI**: レスポンシブデザイン対応

### 🤖 AI支援機能
- **勘定科目自動マッピング**: Azure OpenAI連携
- **参照マッピング**: 既存データからの学習機能
- **バッチ処理**: 大量データの効率的処理

## 技術仕様

### バックエンド
- **Python 3.11** + Flask 2.3+
- **PostgreSQL** データベース
- **SQLAlchemy 2.0** ORM
- **Azure OpenAI API** 連携

### フロントエンド
- **Bootstrap 5** レスポンシブUI
- **Chart.js** データ可視化
- **レーダーチャート** リスク評価表示

### セキュリティ
- **HTTPセキュリティヘッダー**: HSTS、CORS、XSS保護
- **セッション管理**: 暗号化とタイムアウト設定
- **データ正規化**: 自動文字列正規化機能

## パフォーマンス最適化

### 高速化実績
- **JA管理画面**: 4秒 → 1.76秒（56%改善）
- **データベースクエリ最適化**: インデックス活用
- **メモリ使用量削減**: 効率的なデータ処理

### 機能改善
- **年度引き継ぎ修正**: JA管理画面の操作ボタン改善
- **個別行表示**: 各JA-年度組み合わせの明確な表示
- **エラーハンドリング**: 包括的なエラー処理機能

## インストール

### 環境要件
```
Python 3.11+
PostgreSQL 13+
Azure OpenAI API キー
```

### 依存関係
```bash
pip install -r requirements.txt
```

### 環境変数
```bash
DATABASE_URL=postgresql://...
SESSION_SECRET=your-session-secret
AZURE_OPENAI_API_KEY=your-api-key
AZURE_OPENAI_ENDPOINT=your-endpoint
AZURE_OPENAI_DEPLOYMENT=your-deployment
```

### 起動
```bash
gunicorn --bind 0.0.0.0:5000 --reuse-port --reload main:app
```

## 主要機能詳細

### 財務指標分析
- **収益性**: ROA、ROE、売上高利益率
- **流動性**: 流動比率、当座比率
- **効率性**: 総資産回転率、売上債権回転率
- **安全性**: 自己資本比率、負債比率
- **キャッシュフロー**: 営業CF比率、投資CF分析

### データ管理
- **CSVインポート**: BS、PL、CF データの一括取り込み
- **勘定科目マッピング**: 標準科目への自動変換
- **データバックアップ**: 安全なデータ保護機能

## 動作確認済み環境
- JA007/2022年度データで全機能検証完了
- API応答時間0.93秒（安定）
- セキュリティ検証済み
- 全ブラウザ対応確認済み

## ライセンス
MIT License

## 開発者
humejima@foxglove.co.jp