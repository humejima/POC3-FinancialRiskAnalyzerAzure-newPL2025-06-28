<!-- 他JAを参照したマッピング実行フォーム -->
<div class="card shadow mb-4">
  <div class="card-header py-3 d-flex justify-content-between">
    <h6 class="m-0 font-weight-bold text-primary">他JAからの参照マッピング</h6>
  </div>
  <div class="card-body">
    <p>他のJAの既存マッピングデータを参照して、未マッピングの科目を自動的にマッピングします。</p>
    <form action="/reference_map" method="post" target="mapping_result_frame">
      <div class="form-group">
        <label for="ja_code">JAコード</label>
        <select name="ja_code" id="ja_code" class="form-control" required>
          {% for ja in jas %}
          <option value="{{ ja.ja_code }}" {% if session.get('selected_ja_code') == ja.ja_code %}selected{% endif %}>
            {{ ja.ja_code }} ({{ ja.name }})
          </option>
          {% endfor %}
        </select>
      </div>
      <div class="form-group">
        <label for="year">年度</label>
        <select name="year" id="year" class="form-control" required>
          {% for y in range(2021, 2026) %}
          <option value="{{ y }}" {% if session.get('selected_year') == y %}selected{% endif %}>{{ y }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="form-group">
        <label for="file_type">ファイルタイプ</label>
        <select name="file_type" id="file_type" class="form-control" required>
          <option value="bs" {% if file_type == 'bs' %}selected{% endif %}>貸借対照表 (BS)</option>
          <option value="pl" {% if file_type == 'pl' %}selected{% endif %}>損益計算書 (PL)</option>
          <option value="cf" {% if file_type == 'cf' %}selected{% endif %}>キャッシュフロー計算書 (CF)</option>
        </select>
      </div>
      <div class="form-group">
        <label for="confidence_threshold">最低信頼度しきい値</label>
        <input type="range" name="confidence_threshold" id="confidence_threshold" min="0.5" max="1.0" step="0.05" value="0.9" class="form-control-range">
        <div class="d-flex justify-content-between">
          <span>0.5</span>
          <span id="confidence_value">0.9</span>
          <span>1.0</span>
        </div>
      </div>
      <div class="form-group">
        <div class="form-check">
          <input type="checkbox" name="use_top_jas" id="use_top_jas" class="form-check-input" checked>
          <label for="use_top_jas" class="form-check-label">マッピング件数の多い上位JAのみを参照する</label>
        </div>
      </div>
      <button type="submit" class="btn btn-primary w-100">参照マッピングを実行</button>
    </form>
  </div>
  <div class="card-footer text-muted">
    <small>※ 信頼度の高いマッピングデータのみを参照します</small>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // スライダーの値表示を連動
    const confidenceSlider = document.getElementById('confidence_threshold');
    const confidenceValue = document.getElementById('confidence_value');
    
    confidenceSlider.addEventListener('input', function() {
      confidenceValue.textContent = this.value;
    });
  });
</script>