# JA財務リスク分析システム - Pythonプログラム一覧

## システム概要
農業協同組合（JA）の財務データを分析し、リスク評価を行う専門システム。Azure OpenAI APIを活用したAI支援マッピング機能と包括的なデータバックアップ機能を提供。

---

## 1. コアシステム・アプリケーション基盤

### app.py
**機能**: Flaskアプリケーションのメイン設定・初期化
- SQLAlchemyデータベース設定
- PostgreSQL接続設定
- セッション管理設定
- 文字列正規化処理
- アプリケーション全体の基盤構築

### main.py
**機能**: アプリケーションエントリーポイント
- Gunicornサーバー起動時の実行ファイル
- app.pyからFlaskアプリケーションをインポート

### models.py
**機能**: データベースモデル定義
- JA情報テーブル
- CSV財務データテーブル
- 標準勘定科目テーブル
- 勘定科目マッピングテーブル
- 標準勘定科目残高テーブル
- 分析結果テーブル
- 勘定科目計算式テーブル

### routes.py
**機能**: Webルーティング・画面表示制御
- メインダッシュボード表示
- 勘定科目残高一覧表示
- 財務分析画面制御
- JA比較分析画面
- データ管理画面
- CSVアップロード処理

---

## 2. 財務分析・計算エンジン

### financial_indicators.py
**機能**: 財務指標計算エンジン
- 流動性指標計算（流動比率、当座比率、現金比率）
- 収益性指標計算（ROA、ROE、営業利益率）
- 安全性指標計算（自己資本比率、負債比率、固定比率）
- 効率性指標計算（総資産回転率、売掛金回転率）
- キャッシュフロー指標計算
- 前年度比較機能
- リスクスコア算出

### risk_analyzer.py
**機能**: リスクスコア算出・リスク評価分析
- カテゴリ別リスクレベル評価
- 総合リスクスコア計算
- 業界ベンチマークとの比較
- リスク要因特定
- 改善提案生成

### account_calculator.py
**機能**: 勘定科目合計値計算エンジン
- 資産の部合計計算
- 負債の部合計計算
- 純資産の部合計計算
- 計算式定義・管理機能
- 優先度付き計算順序制御

---

## 3. データ処理・インポート

### data_processor.py
**機能**: CSVデータの処理・インポート機能
- CSV財務データの読み込み
- データ形式検証
- 欠損データ処理
- データ型変換
- エラーレポート生成

### create_account_balances.py
**機能**: 標準勘定科目残高データ作成
- 指定JA・年度の残高データ生成
- 財務諸表タイプ別処理
- データ整合性チェック

---

## 4. AI・自動マッピング機能

### ai_account_mapper.py
**機能**: AI支援による勘定科目自動マッピング
- Azure OpenAI API連携
- 完全一致マッピング
- AI支援マッピング（信頼度スコア付き）
- 文字列類似度マッピング
- バッチ処理対応
- マッピング結果統計

### ai_mapping_rules.py
**機能**: JAの預金科目マッピングルール定義
- JA特有の勘定科目ルール
- 預金関連科目の負債科目マッピング
- ルールベース自動判定

### batch_mapping.py
**機能**: バッチ処理による一括マッピング
- 大量データの効率的処理
- タイムアウト防止機能
- 処理進捗管理
- エラーハンドリング

### direct_sql_mapping.py
**機能**: SQLによる直接マッピング処理
- 高速データベース操作
- 一括更新処理
- 参照マッピング機能

---

## 5. バックアップ・データ保護

### backup_system.py
**機能**: データバックアップ・リストア機能
- マッピングデータバックアップ
- 残高データバックアップ（BS/PL/CF別）
- JSON形式での保存
- 既存データ確認機能
- 詳細復元レポート
- データ整合性チェック

### backup_api.py
**機能**: バックアップ機能用APIエンドポイント
- バックアップ作成API
- バックアップ一覧取得API
- データ復元API
- 2段階確認プロンプト
- エラーハンドリング

---

## 6. API・エンドポイント

### api_endpoints.py
**機能**: REST API エンドポイント定義
- リスクデータ取得API
- 勘定科目データ取得API
- JA比較分析API
- キャッシュクリアAPI
- レスポンス形式統一

### clear_cache_route.py
**機能**: キャッシュクリア機能
- JAユーザー登録画面キャッシュクリア
- ブラウザキャッシュバイパス
- 特殊ルート定義

---

## 7. 勘定科目管理・追加

### add_current_assets.py
**機能**: 流動資産科目の追加処理
- 流動資産親科目設定
- 子科目関係定義
- 表示順序設定

### add_total_accounts.py
**機能**: BS合計科目の標準勘定科目マスタ追加
- 貸借対照表合計科目追加
- 階層構造定義
- 計算式設定

---

## 8. データ確認・検証ツール

### check_data.py
**機能**: 指定JA・年度のデータ状態確認
- データ存在チェック
- レコード数確認
- データ品質検証

### check_balance_data.py
**機能**: 残高データの状態確認
- 財務諸表タイプ別残高確認
- 異常値検出
- データ完整性チェック

### check_profitability_data.py
**機能**: 収益性指標関連データの確認
- 利益関連科目確認
- 計算要素検証
- 指標計算テスト

### check_safety_indicators_for_chart.py
**機能**: レーダーチャート用安全性指標確認
- チャート表示データ検証
- 安全性指標値確認
- 表示形式チェック

### check_ja_data.py
**機能**: JAデータとCSVデータの状態確認
- JA登録状況確認
- CSV取り込み状況確認
- データ連携状態検証

---

## 9. デバッグ・トラブルシューティング

### debug_*.py系ファイル
- CSV値デバッグ
- マッピング処理デバッグ
- 完全一致処理デバッグ
- 安全性指標デバッグ
- インポート処理デバッグ

---

## 10. データ修正・メンテナンス

### fix_*.py系ファイル
- 勘定科目親コード修正
- 残高データ修正
- マッピングデータ修正
- 表示順序修正
- CF（キャッシュフロー）データ修正

### ensure_*.py系ファイル
- 必要データ存在確認
- データ整合性保証
- 欠損データ補完

---

## 11. テストデータ作成

### create_*_test_data.py系ファイル
- 参照マッピング機能テストデータ作成
- 最小限テストデータ作成
- 機能検証用データ生成

---

## システム特徴

### 技術スタック
- **Backend**: Python 3.11 + Flask
- **Database**: PostgreSQL
- **AI**: Azure OpenAI API
- **Frontend**: HTML5 + JavaScript + Chart.js
- **Deployment**: Gunicorn + Replit

### 主要機能
1. **財務データ分析**: 5カテゴリの財務指標計算
2. **AI支援マッピング**: 勘定科目の自動分類
3. **リスク評価**: 包括的なリスクスコア算出
4. **データ保護**: 完全なバックアップ・リストア機能
5. **比較分析**: JA間・年度間比較機能

### セキュリティ機能
- 2段階確認プロンプト
- データ操作前の既存データ確認
- 詳細なログ記録
- エラーハンドリング

このシステムは農業協同組合の財務健全性評価と意思決定支援を目的として設計されています。